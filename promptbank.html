<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Wish Fic Fest ‚Äî Prompt Bank (Preview)</title>
<style>
:root{
  --bg:#0f1115; --ink:#f5f7fb; --muted:#a6adbb; --line:#232735;
  --glass:rgba(255,255,255,.06); --soft:rgba(255,255,255,.04);
  --chip:#1b1f2a; --good:#34d399; --bad:#fb7185; --accent:#ff835a;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;color:var(--ink);background:
  radial-gradient(60vw 50vh at 50% -10%, #1a2030 0, transparent 60%),var(--bg)}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:16px 20px;border-bottom:1px solid var(--line);position:sticky;top:0;background:#0f1115cc;backdrop-filter:blur(8px)}
.brand{display:flex;gap:10px;align-items:center}
.logo{width:32px;height:32px;border-radius:8px;display:grid;place-items:center;background:#1c2233}
.right{display:flex;gap:10px;align-items:center}
.avatar{width:32px;height:32px;border-radius:50%;background:linear-gradient(135deg,#7dd3fc,#a78bfa)}
.pill{border:1px solid #2a2f3f;background:#1b1f2a;color:var(--ink);border-radius:999px;padding:8px 14px;cursor:pointer}
.pill.small{padding:6px 10px;font-size:12px}
.pill.ghost{background:transparent}
.shell{max-width:980px;margin:24px auto;padding:0 16px;display:grid;gap:16px}
.glass{background:var(--glass);border:1px solid var(--line);border-radius:24px;box-shadow:0 12px 32px rgba(0,0,0,.35)}
.balance-card{padding:20px}
.balance-card .row{display:flex;justify-content:space-between;align-items:flex-start;gap:10px}
.hi{color:var(--muted);font-size:14px}
.balance{margin:6px 0 2px;font-size:42px;letter-spacing:.5px}
.sub{color:var(--muted);font-size:13px}
.actions{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin:18px 0 8px}
.action{display:flex;gap:10px;align-items:center;justify-content:center;background:#1b1f2a;border:1px solid #2a2f3f;border-radius:14px;padding:14px;font-weight:600;cursor:pointer}
.widgets{display:grid;grid-template-columns:1.2fr .8fr;gap:12px;margin-top:10px}
.glass-soft{background:var(--soft);border:1px solid var(--line);border-radius:18px}
.plan{display:flex;align-items:center;gap:14px;padding:14px}
.w-title{font-weight:600}.w-sub{color:var(--muted);font-size:13px}
.recent{padding:14px}
.chips{display:flex;flex-wrap:wrap;gap:8px}
.chip{background:var(--chip);border:1px solid #293042;padding:8px 12px;border-radius:999px;font-size:13px}
.chips.selectable .chip{cursor:pointer;user-select:none}
.chips.selectable .chip.active{outline:2px solid var(--accent)}
.tx-card{padding:10px 0 0}
.tx-header{padding:0 16px}
.divider{height:3px;width:64px;background:#2a2f3f;border-radius:99px;margin:8px 0 0}
.tx-list{list-style:none;padding:6px 0 0;margin:0}
.tx-item{display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:center;padding:14px 16px;border-top:1px solid var(--line)}
.icon{width:36px;height:36px;border-radius:50%;display:grid;place-items:center;background:#1b1f2a;font-size:18px}
.title{font-weight:600}
.meta{color:var(--muted);font-size:12px}
.amount.positive{color:var(--good);font-weight:700}
.amount.negative{color:var(--bad);font-weight:700}
.badge{font-size:11px;padding:2px 8px;border-radius:999px;background:#202638;border:1px solid #2a2f3f;color:#cfd6e6}
.tabs{display:flex;gap:20px;justify-content:space-around;border-top:1px solid var(--line);padding:10px 14px}
.modal{border:none;padding:0;background:transparent}
.modal::backdrop{background:rgba(0,0,0,.45);backdrop-filter:blur(2px)}
.modal-body{padding:16px;width:min(680px,calc(100vw - 24px))}
.field{display:grid;gap:6px;margin:10px 0}
.field input,.field textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #2a2f3f;background:#121520;color:var(--ink)}
.prompt-list{list-style:none;padding:0;margin:10px 0;display:grid;gap:10px;max-height:40vh;overflow:auto}
.prompt-item{display:grid;grid-template-columns:1fr auto;gap:12px;padding:10px;border:1px solid #2a2f3f;border-radius:12px;background:#121520}
.prompt-item .pair{font-weight:600}.prompt-item .genre{font-size:12px;opacity:.85}
#toast{position:fixed;bottom:18px;left:50%;transform:translateX(-50%);background:#1c2233;border:1px solid #2a2f3f;color:var(--ink);padding:10px 14px;border-radius:12px;display:none}
/* How to use box */
.howto{padding:18px;margin:20px 0;background:#121520;border:1px solid #2a2f3f;border-radius:18px}
.howto h3{margin:0 0 10px;font-size:18px;font-weight:700}
.howto ol{margin:0;padding-left:20px;color:var(--muted)}
.howto li{margin:8px 0;font-size:14px;color:var(--ink)}
/* Claimed look */
.prompt-item.claimed{opacity:.5;pointer-events:none}
.prompt-item.claimed button{display:none}
@media (max-width: 820px){.widgets{grid-template-columns:1fr}.balance{font-size:34px}}
</style>
</head>
<body>
  <header class="topbar">
    <div class="brand"><div class="logo">üí´</div><div class="title">Prompt Bank</div></div>
    <div class="right"><button class="pill ghost" id="toggleTheme" title="Toggle theme">üåó</button><div class="avatar" title="Wishzen"></div></div>
  </header>

  <main class="shell">
    <section class="howto glass">
      <h3>üìò How to Use Prompt Bank</h3>
      <ol>
        <li><strong>Transfer</strong> ‚Äî deposit prompt baru. Pilih genre ‚Üí isi judul & detail ‚Üí <em>Deposit</em>. Balance naik +100 (gimik).</li>
        <li><strong>Request</strong> ‚Äî lihat daftar prompt <em>available</em>. Bisa search / filter genre. Klik <em>Claim</em> untuk mengambil.</li>
        <li><strong>Transactions</strong> ‚Äî semua aksi (submit/claim/complete) muncul seperti catatan bank.</li>
        <li><strong>Claimed</strong> ‚Äî prompt yang sudah di‚Äëclaim otomatis terkunci (abu‚Äëabu & tombol disembunyikan).</li>
        <li><strong>Posted</strong> ‚Äî setelah karya dipost, organizer ubah status ke <em>posted</em> + link karya.</li>
      </ol>
    </section>

    <section class="balance-card glass">
      <div class="row">
        <div>
          <div class="hi">Hi, welcome</div>
          <h1 class="balance"><span class="cur">‚Ç©</span> <span id="balance">2,822,024</span></h1>
          <div class="sub">WON ‚Ä¢ My Prompt Balance</div>
        </div>
        <div class="stat"><button class="pill">Statistics</button></div>
      </div>
      <div class="actions">
        <button class="action" id="btnTransfer"><span>üîÑ</span> Transfer</button>
        <button class="action" id="btnRequest"><span>üì•</span> Request</button>
      </div>
      <div class="widgets">
        <div class="plan glass-soft">
          <div class="emoji">üéØ</div>
          <div>
            <div class="w-title">Prompt Challenge Plan</div>
            <div class="w-sub">Submit 3 prompts this week to earn a ‚ú® badge</div>
          </div>
          <button class="pill small" id="btnEnroll">Get plan</button>
        </div>
        <div class="recent glass-soft">
          <div class="w-title">Recent Genres</div>
          <div class="chips" id="recentGenres">
            <div class="chip">‚ù§Ô∏è Angst</div>
            <div class="chip">üå∏ Fluff</div>
            <div class="chip">üåÄ Time Loop</div>
            <div class="chip">üé≠ Crack</div>
            <div class="chip">üåå Sci‚Äëfi</div>
          </div>
        </div>
      </div>
    </section>

    <section class="tx-card glass">
      <div class="tx-header"><h2>Transactions</h2><div class="divider"></div></div>
      <ul class="tx-list" id="txList"></ul>
      <nav class="tabs"><a class="tab active">Home</a><a class="tab">Bills</a><a class="tab">Events</a><a class="tab">Profile</a></nav>
    </section>
  </main>

  <!-- Transfer Modal -->
  <dialog id="dlgTransfer" class="modal">
    <form method="dialog" class="modal-body glass">
      <h3>Deposit a Prompt</h3>
      <p class="muted">Quick quiz: What kind of genre are you today?</p>
      <div class="chips selectable" id="genreChips">
        <button type="button" class="chip">üå∏ Fluff</button>
        <button type="button" class="chip">‚ù§Ô∏è Angst</button>
        <button type="button" class="chip">üåå Sci‚Äëfi</button>
        <button type="button" class="chip">üåÄ Time Loop</button>
        <button type="button" class="chip">üé≠ Crack</button>
        <button type="button" class="chip">üîÆ Fantasy</button>
      </div>
      <label class="field"><span>Prompt title</span><input id="promptTitle" type="text" placeholder="e.g., Beach summer promise" required /></label>
      <label class="field"><span>Prompt details</span><textarea id="promptDetails" rows="4" placeholder="Short description‚Ä¶"></textarea></label>
      <div class="modal-actions"><button value="cancel" class="pill ghost">Cancel</button><button id="submitPrompt" class="pill">Deposit</button></div>
    </form>
  </dialog>

  <!-- Request Modal -->
  <dialog id="dlgRequest" class="modal">
    <form method="dialog" class="modal-body glass">
      <h3>Request (Claim) a Prompt</h3>
      <label class="field"><span>Search</span><input id="searchInput" type="text" placeholder="keyword, pairing, trope‚Ä¶" /></label>
      <div class="chips selectable" id="filterChips">
        <button type="button" class="chip">All</button>
        <button type="button" class="chip">‚ù§Ô∏è Angst</button>
        <button type="button" class="chip">üå∏ Fluff</button>
        <button type="button" class="chip">üåÄ Time Loop</button>
        <button type="button" class="chip">üåå Sci‚Äëfi</button>
      </div>
      <ul class="prompt-list" id="promptList"></ul>
      <div class="modal-actions"><button value="cancel" class="pill ghost">Close</button></div>
    </form>
  </dialog>

  <div id="toast"></div>

<script>
// ====== Elements (make sure they exist BEFORE use) ======
const balanceEl   = document.getElementById('balance');
const txList      = document.getElementById('txList');
const dlgTransfer = document.getElementById('dlgTransfer');
const dlgRequest  = document.getElementById('dlgRequest');
const genreChips  = document.getElementById('genreChips');
const promptTitle = document.getElementById('promptTitle');
const promptDetails = document.getElementById('promptDetails');
const submitPrompt  = document.getElementById('submitPrompt');
const recentGenres  = document.getElementById('recentGenres');
const promptList    = document.getElementById('promptList'); // <-- FIX: define promptList
const searchInput   = document.getElementById('searchInput');
const filterChips   = document.getElementById('filterChips');
const toast         = document.getElementById('toast');

// ====== Minimal self-tests (debug safety) ======
(function selfTests(){
  const missing = [
    ['balanceEl', balanceEl], ['txList', txList], ['promptList', promptList],
    ['dlgTransfer', dlgTransfer], ['dlgRequest', dlgRequest]
  ].filter(([n,el]) => !el).map(([n])=>n);
  if(missing.length){
    console.error('Missing DOM nodes:', missing);
    alert('Init error: missing nodes ‚Üí '+missing.join(', '));
  } else {
    console.log('Self-tests passed ‚úÖ');
  }
})();

let balance = 2822024; // WON
let transactions = [
  { icon:'üìù', title:'Submitted Prompt: Cherry Soda AU', meta:'20-01-2025, 06:00', amount:-500, status:'Completed' },
  { icon:'üì•', title:'Claimed Prompt: RiYu ‚Äî Time Loop', meta:'20-01-2025, 06:10', amount:+800, status:'Completed' },
  { icon:'üèÅ', title:'Completed Prompt: Sion/Jaehee ‚Äî Slice of Life', meta:'20-01-2025, 07:40', amount:+1500, status:'Completed' },
];

// A few prompts; one already claimed
const MOCK_PROMPTS = [
  {id:1, pair:'RiYu',        title:'Summer train to Fukui',           genre:'üå∏ Fluff',   claimed:false},
  {id:2, pair:'Sion/Jaehee', title:'Study room: enemy‚Äëto‚Äëlovers notes',genre:'‚ù§Ô∏è Angst',  claimed:true}, // pre‚Äëclaimed example
  {id:3, pair:'Ryo/Satya',   title:'Midnight arcade pact',            genre:'üåÄ Time Loop',claimed:false},
  {id:4, pair:'RiYu',        title:'Venus research diary',            genre:'üåå Sci‚Äëfi',  claimed:false},
  {id:5, pair:'Yushi/Jaehee',title:'Snow after‚Äëparty',                genre:'üé≠ Crack',  claimed:false},
];

function format(n){ return n.toLocaleString('en-US'); }
function renderBalance(){ balanceEl.textContent = format(balance); }
function renderTx(){
  txList.innerHTML = '';
  transactions.forEach(tx => {
    const li = document.createElement('li');
    li.className = 'tx-item';
    li.innerHTML = `
      <div class="icon">${tx.icon}</div>
      <div>
        <div class="title">${tx.title}</div>
        <div class="meta">${tx.meta} ‚Ä¢ <span class="badge">${tx.status}</span></div>
      </div>
      <div class="amount ${tx.amount>=0?'positive':'negative'}">${tx.amount>=0?'+':''}${tx.amount.toLocaleString('en-US')}.00</div>`;
    txList.appendChild(li);
  });
}

// Render prompt list, respecting claimed state
function renderPromptList(list){
  promptList.innerHTML = '';
  list.forEach(p=>{
    const li = document.createElement('li');
    li.className = 'prompt-item';
    if(p.claimed) li.classList.add('claimed');
    li.innerHTML = `<div><div class="top"><span class="pair">${p.pair}</span> ‚Ä¢ <span>${p.title}</span></div><div class="genre">${p.genre}</div></div>`+
      (p.claimed ? `<span class="badge">Claimed</span>` : `<button class="pill small" data-claim="${p.id}">Claim</button>`);
    promptList.appendChild(li);
  });
}

// Initial paints
renderBalance();
renderTx();
renderPromptList(MOCK_PROMPTS);

// Theme toggle (for fun)
document.getElementById('toggleTheme').addEventListener('click', ()=>{
  document.body.classList.toggle('light');
});

// Transfer flow
document.getElementById('btnTransfer').addEventListener('click', ()=>{
  [...genreChips.querySelectorAll('.chip')].forEach(c=>c.classList.remove('active'));
  promptTitle.value='';
  promptDetails.value='';
  dlgTransfer.showModal();
});

genreChips.addEventListener('click', (e)=>{
  if(e.target.classList.contains('chip')){
    [...genreChips.querySelectorAll('.chip')].forEach(c=>c.classList.remove('active'));
    e.target.classList.add('active');
  }
});

submitPrompt.addEventListener('click', (e)=>{
  e.preventDefault();
  const selected = genreChips.querySelector('.chip.active');
  const genre = selected ? selected.textContent.trim() : 'üå∏ Fluff';
  const title = promptTitle.value || 'Untitled Prompt';
  transactions.unshift({
    icon:'üìù',
    title:`Submitted Prompt: ${title}`,
    meta:`${new Date().toLocaleDateString('en-GB')} ${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`,
    amount:-500,
    status: genre
  });
  const chip = document.createElement('div'); chip.className='chip'; chip.textContent=genre; recentGenres.prepend(chip);
  balance += 100; renderBalance(); renderTx(); dlgTransfer.close(); showToast('Prompt deposited! +100 interest added.');
});

// Request (claim) flow

document.getElementById('btnRequest').addEventListener('click', ()=> dlgRequest.showModal());

filterChips.addEventListener('click', (e)=>{
  if(!e.target.classList.contains('chip')) return;
  const g = e.target.textContent.trim();
  const filtered = g==='All' ? MOCK_PROMPTS : MOCK_PROMPTS.filter(p=>p.genre===g);
  renderPromptList(filtered);
});

searchInput.addEventListener('input', ()=>{
  const q = searchInput.value.toLowerCase();
  renderPromptList(MOCK_PROMPTS.filter(p => p.title.toLowerCase().includes(q) || p.pair.toLowerCase().includes(q)));
});

promptList.addEventListener('click', (e)=>{
  const id = e.target.getAttribute('data-claim');
  if(!id) return;
  const item = MOCK_PROMPTS.find(p=>p.id==id);
  if(!item || item.claimed) return; // guard
  item.claimed = true;
  transactions.unshift({ icon:'üì•', title:`Claimed Prompt: ${item.pair} ‚Äî ${item.title}`, meta:`${new Date().toLocaleDateString('en-GB')} ${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}`, amount:+800, status:'Claimed' });
  balance += 800; renderBalance(); renderTx(); renderPromptList(MOCK_PROMPTS); showToast('Prompt claimed! +800 credited.');
});

function showToast(msg){
  toast.textContent = msg; toast.style.display = 'block';
  setTimeout(()=> toast.style.display='none', 1600);
}
</script>
</body>
</html>
